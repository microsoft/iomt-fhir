# Partition Locking

Below is a flowchart of an event hub processor implementation that locks the partitions before reading events from the partition. The locking (via blob leases) is done so that two event hub processors cannot both read from the same event hub partition(s) at the same time.

See [PartitionLockingService.cs](https://github.com/microsoft/iomt-fhir/pull/268/files#diff-316b56d2a26014f9f8a392be2c1d400b48f9f7689e1b7c5e00113671e69e875f) and [PartitionCoordinator.cs](https://github.com/microsoft/iomt-fhir/pull/268/files#diff-89ff615f3dcbf679f7f8b056961fbd87f12098af45bae6ae0c26650e1d672651) for the actual code implementation.

[![](https://mermaid.ink/img/pako:eNqVVU1z2jAQ_Ss7OpNMwMEBDu1Qmmk5tM2E9NBCDrIl25rakmNJTQnDf-9a_mz4yJSDsaR9b9dPb6UdCRXjZEaiVD2HCS0MPHzYSMCftkFc0DyBgsdCG14AzfNUhNQIJYFKBjR8sqLgkCNMlLO6Qq4MTqzdE-Yd5hEuLt7BJy55QQ1fsnXzChTyQoVcaxAMYivYY0XUxZbI73mqKENc9dLHCAlBqgLQRhU05jW8Abi8C5qGNkWyXkVLqQ2VSLJuV0HaLMBvVREYZWgK_DeXBhIbNPnUv0KIhgOCLTxZXmyFjI9Vc7aAVyVqLWLJ2V0r7NECO92xVgi4qzXdAq3h5SynYdJVflDKQSJXyLza2F76-cFWD8DmZQKTcAhp6ugYCkAlBmxxVbc6pJxqruvcB9wuYzes19luZaNIhKJUv2F99dG1_9j7fUV9SOK4HRHSHC6vf7RlncDiBp1Gf1U1-FzUcUErHJes7pjz8Hsr75ot3OGgb0Xsw4JjNzifaogKlbXC9MSqJeozOWaE3jrkXLJ7bLfnb8_YczoR-W6hUHRpaYqW6qcoyrCOGlSDaHKc5qxsnvDw1zJq61goK80ioTLGXf9Mdd_hTYwG_NaDhuysEFZwQNOF3HmykyhBSl0eRp1TzpVQ-fHYSs8u_0mw1A8JX9GMd545EQBv7MoxcD_vyqi8XV2Xo0aJsh0rdzTHQ6ffY3Nw98BvHUkVhAxIxouMCoaXyK6c2xCUP-MbMsNXxiNqU7MhG7nHUGqNWm1lSGamsHxAbM6Q-6OgeNNkZBbRVLezt0zg-dlOcjf8Ut1W7tIakJzKn0plDRsOyWxH_pDZ0Pcup9PpxPeGw_H10Jt4A7Ils4vrkX85Gnk31zdjz8f_yXg_IC-OYng5vhr53mgy9j1_ejWc-Pu_kdON1w?type=png)](https://mermaid.live/edit#pako:eNqVVU1z2jAQ_Ss7OpNMwMEBDu1Qmmk5tM2E9NBCDrIl25rakmNJTQnDf-9a_mz4yJSDsaR9b9dPb6UdCRXjZEaiVD2HCS0MPHzYSMCftkFc0DyBgsdCG14AzfNUhNQIJYFKBjR8sqLgkCNMlLO6Qq4MTqzdE-Yd5hEuLt7BJy55QQ1fsnXzChTyQoVcaxAMYivYY0XUxZbI73mqKENc9dLHCAlBqgLQRhU05jW8Abi8C5qGNkWyXkVLqQ2VSLJuV0HaLMBvVREYZWgK_DeXBhIbNPnUv0KIhgOCLTxZXmyFjI9Vc7aAVyVqLWLJ2V0r7NECO92xVgi4qzXdAq3h5SynYdJVflDKQSJXyLza2F76-cFWD8DmZQKTcAhp6ugYCkAlBmxxVbc6pJxqruvcB9wuYzes19luZaNIhKJUv2F99dG1_9j7fUV9SOK4HRHSHC6vf7RlncDiBp1Gf1U1-FzUcUErHJes7pjz8Hsr75ot3OGgb0Xsw4JjNzifaogKlbXC9MSqJeozOWaE3jrkXLJ7bLfnb8_YczoR-W6hUHRpaYqW6qcoyrCOGlSDaHKc5qxsnvDw1zJq61goK80ioTLGXf9Mdd_hTYwG_NaDhuysEFZwQNOF3HmykyhBSl0eRp1TzpVQ-fHYSs8u_0mw1A8JX9GMd545EQBv7MoxcD_vyqi8XV2Xo0aJsh0rdzTHQ6ffY3Nw98BvHUkVhAxIxouMCoaXyK6c2xCUP-MbMsNXxiNqU7MhG7nHUGqNWm1lSGamsHxAbM6Q-6OgeNNkZBbRVLezt0zg-dlOcjf8Ut1W7tIakJzKn0plDRsOyWxH_pDZ0Pcup9PpxPeGw_H10Jt4A7Ils4vrkX85Gnk31zdjz8f_yXg_IC-OYng5vhr53mgy9j1_ejWc-Pu_kdON1w)